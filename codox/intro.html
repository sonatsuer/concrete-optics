<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Introduction to concrete-optics</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Concrete-optics</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>Introduction to concrete-optics</span></div></a></li><li class="depth-1 "><a href="showcase.html"><div class="inner"><span>Showcase</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>concrete-optics</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>algebra</span></div></div></li><li class="depth-3 branch"><a href="concrete-optics.algebra.axioms.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>axioms</span></div></a></li><li class="depth-3 branch"><a href="concrete-optics.algebra.equality.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>equality</span></div></a></li><li class="depth-3"><a href="concrete-optics.algebra.structures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>structures</span></div></a></li><li class="depth-2 branch"><a href="concrete-optics.base.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>base</span></div></a></li><li class="depth-2 branch"><a href="concrete-optics.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2 branch"><a href="concrete-optics.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>iso</span></div></div></li><li class="depth-3 branch"><a href="concrete-optics.iso.axioms.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>axioms</span></div></a></li><li class="depth-3"><a href="concrete-optics.iso.structures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>structures</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>lens</span></div></div></li><li class="depth-3 branch"><a href="concrete-optics.lens.axioms.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>axioms</span></div></a></li><li class="depth-3"><a href="concrete-optics.lens.structures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>structures</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>prism</span></div></div></li><li class="depth-3 branch"><a href="concrete-optics.prism.axioms.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>axioms</span></div></a></li><li class="depth-3"><a href="concrete-optics.prism.structures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>structures</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>traversal</span></div></div></li><li class="depth-3 branch"><a href="concrete-optics.traversal.axioms.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>axioms</span></div></a></li><li class="depth-3"><a href="concrete-optics.traversal.structures.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>structures</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introduction-to-concrete-optics" id="introduction-to-concrete-optics"></a>Introduction to concrete-optics</h1>
<h2><a href="#tldr" id="tldr"></a>TL;DR</h2>
<p>Optics are general and composable constructions that allow bidirectional access to immutable data.</p>
<p>Here is an example of an optic –a traversal to be more precise– which focuses on positive elements with key <code>:a</code> inside a map inside a vector.</p>
<pre><code class="language-clojure">(def nested-data
  [{:a 1 :b 2} {:c 3} {:a -5} {:a 7 :z 22}])

(def each-positive-a
  (opt/compose opt/vector-traversal
               (opt/ix :a)
               (opt/predicate-prism #(&gt; % 0))))

(deftest list-positive-as-test
  (testing "listing elements with a filtering condition"
    (is (= (opt/to-list each-positive-a nested-data)
           [1 7]))))

(deftest modify-positive-as-test
  (testing "modifying only the values fitting a filtering condition"
    (is (= (opt/over each-positive-a inc nested-data)
           [{:a 2, :b 2} {:c 3} {:a -5} {:a 8, :z 22}]))))
</code></pre>
<h2><a href="#implementation-idea" id="implementation-idea"></a>Implementation Idea</h2>
<p>There is a very general <a href="https://ncatlab.org/nlab/show/optic+%28in+computer+science%29">definition</a> of optics which relies on a nontrivial amount of mathematical background. We will not be working with that here. Instead, we will take a more <em>concrete</em> approach and work with certain capabilities an optic can have. Behind the curtains, each optic will be a map of capabilities.</p>
<p>As a simple mental model, we can think of an optic connecting a <em>big</em> whole to a <em>small</em> part. Sometimes we say that the optic focuses on the small part. Here is a list of capabilities with their intuitive meanings:</p>
<ul>
<li><strong>view</strong>: Gives you the small part of the whole. Typically field accessors are views.</li>
<li><strong>to-list</strong>: Very much like <strong>view</strong>, but instead of a single element it focuses on many –possibly zero– elements.</li>
<li><strong>review</strong>: Given an element of the small part, constructs a big whole. Typically sum type constructors are reviews.</li>
<li><strong>over</strong>: Turns a transformation over the small part into a transformation of the whole.</li>
<li><strong>traverse</strong>: Allows you to perform a “structured for loop” over the focus.</li>
</ul>
<p>There are also formal laws we expect these capabilities to satisfy. You can find their precise formulations in the test modules.</p>
<p>Here is a table which classifies optics in terms of their capabilities.</p>
<table>
<thead>
<tr><th>               </th><th align="center">  view </th><th align="center"> to-list</th><th align="center"> review </th><th align="center"> over </th><th align="center"> traverse </th></tr>
</thead>
<tbody>
<tr><td> isomorphism   </td><td align="center">   ✓   </td><td align="center">    ✓   </td><td align="center">   ✓    </td><td align="center">  ✓   </td><td align="center">    ✓     </td></tr>
<tr><td> lens          </td><td align="center">   ✓   </td><td align="center">    ✓   </td><td align="center">        </td><td align="center">  ✓   </td><td align="center">    ✓     </td></tr>
<tr><td> prism         </td><td align="center">       </td><td align="center">    ✓   </td><td align="center">   ✓    </td><td align="center">  ✓   </td><td align="center">    ✓     </td></tr>
<tr><td> traversal     </td><td align="center">       </td><td align="center">    ✓   </td><td align="center">        </td><td align="center">  ✓   </td><td align="center">    ✓     </td></tr>
</tbody>
</table>
<p>When we compose two optics, we compose their corresponding capabilities. If a capability is not a common capability of the optics then it is lost. For instance composition of two optics of the same kind is another of the same kind. An optic and its composition with an isomorphism are of the same kind since isomorphisms have all the capabilities. But the composition of a prism and a lens is a traversal.</p>
<h2><a href="#what-is-missing" id="what-is-missing"></a>What is Missing</h2>
<p>This framework can easily support the optics <code>getter</code> (which has <code>view</code> and <code>to-list</code>), <code>setter</code> (which has <code>over</code>) and <code>fold</code> (which has <code>to-list</code>). I omitted them since they are not as useful.</p>
<p>There is a general notion duality in optics where you change the roles of the whole and the piece. For instance the function <code>invert-iso</code> is an implementation of this idea. However, in this capability only formalism, it is not possible to invert, say, a prism twice and get the original prism. The system can certainly be expanded to support this, though.</p>
<p>Exotic optics like grates or achromatic lenses are not implemented because, well, they are exotic and implementing them  would require a change in the current design which is dead simple.</p>
</div></div></div></body></html>